<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>News - कृषिMitr</title>
  <link rel="shortcut icon" href="./favicon.svg" type="image/svg+xml">
  <link rel="stylesheet" href="./assets/css/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&family=Playfair+Display:wght@600&display=swap" rel="stylesheet">
  
  <style>
    /* MASTER HEADER STYLES */
    .header .container { display: flex !important; align-items: center !important; justify-content: space-between !important; padding-block: 15px; }
    .navbar-list { display: flex; align-items: center; gap: 30px; margin: 0; padding: 0; }
    .navbar-link { font-weight: 600; color: var(--davys-gray); padding: 10px 0; }
    .header-right-group { display: flex !important; align-items: center !important; gap: 20px; margin-left: auto; }
    
    .nav-cart-box { position: relative; font-size: 1.8rem; color: #333; cursor: pointer; display: flex; align-items: center; margin-right: 5px; }
    .cart-badge { position: absolute; top: -8px; right: -10px; background-color: #ff4757; color: white; font-size: 0.75rem; font-weight: bold; width: 18px; height: 18px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    
    .lang-box { display: flex; align-items: center; background-color: #ffffff; border: 1px solid #e0e0e0; border-radius: 50px; padding: 0 15px; min-width: 110px; height: 45px; overflow: hidden; }
    .lang-box ion-icon { font-size: 1.5rem; color: #333; margin-right: 8px; }
    #language-select { border: none; outline: none; background: transparent; font-family: 'Montserrat'; font-weight: 600; color: #333; font-size: 1rem; cursor: pointer; width: 100%; }
    
    .nav-profile-btn { width: 45px; height: 45px; background-color: #1e7e34; color: white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; text-decoration: none; transition: 0.3s; }
    .header .btn { margin-inline-start: 0 !important; padding: 0 40px !important; height: 45px !important; display: flex !important; align-items: center !important; justify-content: center !important; font-size: 1.1rem !important; font-weight: 700 !important; min-width: 140px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    
    .goog-te-banner-frame.skiptranslate { display: none !important; } body { top: 0px !important; } .goog-te-gadget { font-size: 0 !important; }
    
    @media (max-width: 992px) { .navbar { display: none; } .header-right-group { margin-right: 60px; gap: 10px; } .lang-box { padding: 0 8px; min-width: auto; height: 40px !important; } }
    
    /* --- NEWS CARD FIXES --- */
    .page-banner { padding-top: 150px; padding-bottom: 80px; background-color: var(--cultured); text-align: center; }
    .page-banner .h1 { color: var(--black-chocolate); }
    
    .grid-list {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); /* Better responsiveness */
        gap: 30px;
    }

    .course-card { 
        height: 100%; 
        display: flex; 
        flex-direction: column; 
        background: white; 
        border-radius: 12px; 
        overflow: hidden; 
        box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
        transition: 0.3s; 
        border: 1px solid #eee;
    }
    .course-card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.15); }
    
    .card-banner { height: 200px; overflow: hidden; }
    .img-cover { width: 100%; height: 100%; object-fit: cover; }

    .card-content { padding: 25px; flex-grow: 1; display: flex; flex-direction: column; }
    
    .card-title { 
        font-size: 1.4rem; 
        font-weight: 700; 
        color: #333; 
        margin-bottom: 15px; 
        line-height: 1.4; 
        display: -webkit-box; 
        -webkit-lineclamp: 3; 
        -webkit-box-orient: vertical; 
        overflow: hidden; 
    }
    
    /* BUTTON FIX */
    .btn-read { 
        margin-top: auto; 
        align-self: flex-start; /* Keeps button left aligned */
        background: #e8f5e9; 
        color: #1e7e34; 
        padding: 10px 20px; 
        border-radius: 30px; 
        font-weight: 600; 
        font-size: 0.9rem; 
        transition: 0.3s; 
        display: inline-flex; /* Key for alignment */
        align-items: center; 
        gap: 8px; /* Space between text and arrow */
        text-decoration: none;
        width: fit-content; /* Prevents stretching */
    }
    .btn-read ion-icon { font-size: 1.2rem !important; } /* Force small icon */
    .btn-read:hover { background: #1e7e34; color: white; }
  </style>
</head>

<body id="top">

  <header class="header" data-header>
    <div class="container">
      <a href="index.html" class="logo">कृषिMitr<span class="span">.</span></a>
      <nav class="navbar" data-navbar>
        <ul class="navbar-list">
          <li class="navbar-item"><a href="index.html" class="navbar-link">Home</a></li>
          <li class="navbar-item"><a href="news.html" class="navbar-link active">News</a></li>
          <li class="navbar-item"><a href="fertilizer-store.html" class="navbar-link">Marketplace</a></li>
          <li class="navbar-item"><a href="crop-guide.html" class="navbar-link">Crop Guide</a></li>
          <li class="navbar-item"><a href="weather.html" class="navbar-link">Weather</a></li>
          <li class="navbar-item"><a href="contact.html" class="navbar-link">Contact</a></li>
        </ul>
      </nav>
      <div class="header-right-group">
        <a href="fertilizer-store.html" class="nav-cart-box" title="Your Cart">
            <ion-icon name="cart-outline"></ion-icon>
            <span class="cart-badge" id="global-cart-count">0</span>
        </a>
        <div class="lang-box">
          <ion-icon name="language-outline"></ion-icon>
          <select id="language-select" onchange="changeLanguage(this.value)">
            <option value="en">English</option>
            <option value="hi">हिंदी</option>
          </select>
        </div>
        <div id="auth-container">
            <a href="signup.html" class="btn btn-primary" id="auth-button">Sign Up</a>
        </div>
      </div>
      <button class="nav-toggle-btn" aria-label="open manu" data-nav-toggler><ion-icon name="menu-outline"></ion-icon></button>
      <div class="overlay" data-nav-toggler data-overlay></div>
    </div>
  </header>

  <main>
    <article>
      <section class="section page-banner">
        <div class="container">
          <h1 class="h1">Global Agri-News</h1>
          <p class="p">Real-time updates on agriculture, markets, and technology from around the world.</p>
        </div>
      </section>

      <section class="section course">
        <div class="container">
          <ul class="grid-list" id="news-container">
             <p style="text-align: center; width: 100%; font-size: 1.5rem; color: #666;">
               Loading latest headlines...
             </p>
          </ul>
        </div>
      </section>
    </article>
  </main>

  <footer class="footer" id="footer">
    <div class="footer-bottom"><div class="container"><p class="copyright">&copy; 2025 Krishimitr.</p></div></div>
  </footer>

  <script src="./assets/js/script.js" defer></script>
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

  <script>
    const API_KEY = "pub_aa53d72288e74dcf9b2d3e7183148e1b"; // Your Key
    
    const mockNews = [
        {
            title: "Govt announces new MSP rates for Rabi crops 2025",
            image_url: "./assets/images/courses-4.jpg",
            link: "#",
            source_id: "Krishi Jagran",
            pubDate: "2025-10-15"
        },
        {
            title: "New Nano-Urea plant inaugurated in Gujarat to boost yield",
            image_url: "./assets/images/courses-4.jpg",
            link: "#",
            source_id: "Times of India",
            pubDate: "2025-10-14"
        },
        {
            title: "Organic farming adoption rises by 15% in North India",
            image_url: "./assets/images/courses-4.jpg",
            link: "#",
            source_id: "The Hindu",
            pubDate: "2025-10-12"
        }
    ];

    async function fetchNews() {
        const container = document.getElementById('news-container');
        const url = `https://newsdata.io/api/1/news?apikey=${API_KEY}&q=agriculture&country=in&language=en`;

        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error("API Error");
            const data = await response.json();
            if (!data.results || data.results.length === 0) throw new Error("No articles");
            renderNews(data.results);
        } catch (error) {
            console.warn("Using backup news:", error);
            renderNews(mockNews);
        }
    }

    function renderNews(articles) {
        const container = document.getElementById('news-container');
        container.innerHTML = ""; 

        articles.forEach(article => {
            const image = article.image_url || './assets/images/courses-4.jpg';
            const url = article.link;
            const source = article.source_id;
            const date = article.pubDate ? article.pubDate.split(" ")[0] : "Today";

            // Using onerror to replace broken images instantly
            const cardHTML = `
            <li>
              <div class="course-card">
                <figure class="card-banner">
                  <img src="${image}" loading="lazy" alt="News" class="img-cover" onerror="this.src='./assets/images/courses-4.jpg'">
                </figure>
                <div class="card-content">
                  <p class="card-author" style="margin-bottom:10px; font-size:0.9rem; color:#666;">
                    <span class="span" style="color:#1e7e34; font-weight:bold; text-transform:capitalize;">${source}</span>
                    <span style="float:right;">${date}</span>
                  </p>
                  <h3 class="h3">
                    <a href="${url}" target="_blank" class="card-title">${article.title}</a>
                  </h3>
                  <a href="${url}" target="_blank" class="btn-read">
                    Read Article <ion-icon name="arrow-forward-outline"></ion-icon>
                  </a>
                </div>
              </div>
            </li>
            `;
            container.innerHTML += cardHTML;
        });
    }

    document.addEventListener('DOMContentLoaded', fetchNews);
    document.addEventListener('DOMContentLoaded', () => {
         const count = localStorage.getItem('krishiCartCount') || 0;
         document.getElementById('global-cart-count').textContent = count;
    });
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { firebaseConfig } from "./assets/js/config.js"; 
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const authContainer = document.getElementById('auth-container');
    
    onAuthStateChanged(auth, (user) => {
        if (user) {
            authContainer.innerHTML = `<a href="dashboard.html" class="nav-profile-btn"><ion-icon name="person-circle-outline"></ion-icon></a>`;
        } else {
            authContainer.innerHTML = `<a href="signup.html" class="btn btn-primary" id="auth-button">Sign Up</a>`;
        }
    });
  </script>
</body>
</html>